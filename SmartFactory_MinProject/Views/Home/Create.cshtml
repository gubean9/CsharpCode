@model SmartFactory_MinProject.Models.Codeboard

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>


<div class="row">
    <form asp-action="Create">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div style="float:right">
            <input type="submit" value="Create" class="btn btn-outline-primary" /> |
            <a asp-action="Index" class="btn btn-outline-dark">Cancle</a>
        </div>
        <div>
            <h4 class="float:left;">Codeboard</h4>
            <hr />
        </div>
        
        <div class="form-group col-md-5" style='float:right;'>
            <div class="input-group">
                <div class="input-group-text">Name</div>
                <input asp-for="Name" class="form-control" />
            </div>
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        
        <div class="form-group col-md-6">
            <div class="input-group">
                <div class="input-group-text">Title</div>
                <input asp-for="Title" class="form-control" />
            </div>
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>
        
        <br />

        <div class="form-group col-md-12">
            <div class="input-group">
                <div class="input-group-text">Contents</div>
                <textarea id="codeBoxes" asp-for="Contents" class="form-control" rows="15"></textarea>
            </div>
            <span asp-validation-for="Contents" class="text-danger"></span>
        </div>
        <br />
        <button type="button" class="btn btn-outline-primary" onclick="addCodeBox()">Add Code Box</button>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <!-- highlight.js 스타일 및 스크립트 추가 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
    @*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/dracula.min.css"> *@<!-- 다크 모드 스타일 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>

    <script>
        var codeBoxCount = 1; // 코드박스의 고유 ID를 추적하기 위한 변수

        function addCodeBox() {
            var codeBoxes = document.getElementById("codeBoxes");

            // 코드박스의 HTML 코드 생성
            var codeBoxHtml = `<pre><code id="codeBlock${codeBoxCount}">\n내용을 여기에 입력하세요\n</code></pre>`;

            // 코드박스를 textarea에 추가
            codeBoxes.value += codeBoxHtml;

            // 코드 언어 자동 감지 설정
            var codeBlock = document.getElementById(`codeBlock${codeBoxCount}`);
            hljs.highlightBlock(codeBlock);

            codeBoxCount++; // 다음 코드박스를 위해 고유 ID 증가
        }
    </script>
}




<!-- Include jQuery and Bootstrap -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- JavaScript 코드 -->
<script>
    // 폼 제출 시 모델 유효성 검사 실행
    $("form").submit(function (event) {
        event.preventDefault(); // 기본 제출 동작 방지

        // AJAX 요청으로 모델 유효성 검사 실행
        $.ajax({
            url: "@Url.Action("ValidateModel", "Home")", // 유효성 검사를 수행할 액션 메서드 경로
            type: "POST",
            data: $(this).serialize(), // 폼 데이터 전송
            success: function (result) {
                if (result.isValid) {
                    // 유효성 검사 통과 시 폼 제출
                    $("form")[0].submit();
                } else {
                    // 오류 메시지 팝업 표시
                    $("#errorModal .modal-body").html(result.errors.join("<br>"));
                    $("#errorModal").modal("show");
                }
            }
        });
    });
</script>

<!-- 오류 메시지를 표시할 Bootstrap 모달 -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">유효성 검사 오류</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- 오류 메시지가 여기에 표시됩니다. -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>